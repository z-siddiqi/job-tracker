{% load crispy_forms_tags %}

<form action="{% url 'board_create' %}" onsubmit="handleBoardCreateFormSubmit(event)">
    {% csrf_token %}
    <div class="modal-header">
        <h5 class="modal-title">New Board</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body">
        {{ form|crispy }}
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn btn-dark me-auto">Create</button>
    </div>
</form>

<script type="module">
    import { EmojiButton } from "https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@latest/dist/index.min.js";

    const picker = new EmojiButton({
        position: "bottom-start",
        showPreview: false,
        autoFocusSearch: false,
        emojisPerRow: 6,
        rows: 4
    });
    
    const iconInput = document.querySelector("#id_icon");

    picker.on("emoji", selection => {
        iconInput.value = selection.emoji;
    });

    iconInput.addEventListener("click", (e) => {
        e.preventDefault();
        e.stopPropagation();
        picker.togglePicker(iconInput)
    });
</script>
<script>
    async function handleBoardCreateFormSubmit(e) {
        e.preventDefault();
        const iconField = {"icon": document.querySelector("#id_icon").value};
        const form = e.target;
        submitForm(form, [iconField])
            .then((data) => {
                if (data.form) {
                    const modalContent = form.closest(".modal-content");
                    setInnerHTML(modalContent, data.form);
                } else {
                    window.location.href = data.url;
                }
            })
            .catch((error) => console.log(error));
    };
</script>